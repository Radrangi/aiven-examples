.PHONY: check-deps init apply kill

PLAN_FILE="out.tfplan"

default: yolo

check-deps:
	@command -v psql > /dev/null || echo "Oops... 'psql' is not installed. Please install that first 'cause we gotta run some queries."; exit

init: check-deps
	@echo "âœ¨ Setting up terraform... ğŸ› "
	@terraform fmt -recursive .
	@terraform init

plan: init
	@echo "âœ¨ Starting terraform magic... ğŸ§™"
	@terraform plan -out="${PLAN_FILE}"

apply:
	@echo "âœ¨ Applying changes... ğŸš€"
	@terraform apply ${PLAN_FILE}

yolo: plan
	@echo "ğŸ”¥ Let's goooooo... ğŸ¤ª"
	@terraform apply -auto-approve ${PLAN_FILE}

kill:
	@echo "ğŸ”ª Killing 'em with fire!!! ğŸ”¥ğŸ”¥ğŸ”¥"
	@terraform destroy